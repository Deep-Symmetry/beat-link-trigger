= Shows
James Elliott <james@deepsymmetry.org>
:icons: font
:toc:
:experimental:
:toc-placement: preamble
:toclevels: 3
:guide-top: README

// Set up support for relative links on GitHub, and give it
// usable icons for admonitions, w00t! Add more conditions
// if you need to support other environments and extensions.
ifdef::env-github[]
:outfilesuffix: .adoc
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::env-github[]

// Render section header anchors in a GitHub-compatible way when
// building the embedded user guide.
ifndef::env-github[]
:idprefix:
:idseparator: -
endif::env-github[]

Watch for beat ranges of specific tracks to be played, and send things
like MIDI or OSC messages in response.

== Overview

Version 0.5 of Beat Link Trigger introduced a major new set of user
interface features called the Show interface, which make it far easier
to match tracks, and cause things to happen when particular beat
ranges in those tracks are played.

All of these things could be done before the Show interface (and
several people put together quite sophisticated shows) using basic
Triggers, but they involved writing a great many custom Expressions to
match the tracks and watch for the right beats, and were very tedious
to figure out, requiring lots of time hooked up to CDJs during the
design process.

Also, there is a practical limit to how many Triggers you can have in
your file, because each one gets considered in sequence whenever a
packet is received from a player. The limit may be a few dozen, or
many more, but eventually your CPU will be get busy just evaluating
triggers. The Show interface doesn't have this limitation--it uses a
sophisticated and efficient mechanism for recognizing tracks, and
allows you to add thousands of tracks to your Shows. Tracks in a Show
will not put any load on your CPU until they are actually loaded in a
player.

Finally, because tracks can be added to a Show either from players on
the network, or by reading them directly from your rekordbox USB or SD
media, you can set up your Shows, draw cues on the tracks' beat grids,
with reference to their waveforms, and configure the messages you want
the cues to send, even in situations where you don't have access to
CDJs. Almost all of the Show interface features are fully functional
when Beat Link Trigger is operating in Offline mode, and the ones that
don't make sense are simply hidden from view. This supports a flexible
and convenient workflow.

== Creating a Show

To use the Show interface, you start by choosing menu:File[New Show]
in the Beat Link Triggers window.

image:assets/NewShow.png[New Show option,314,210]

This opens a Save dialog where you choose the location and name of
your new Show file. Navigate to where you would like to keep it, type
a name, and click kbd:[Save].

image:assets/NewShow2.png[New Show Save dialog,660,460]

Beat Link Trigger will create a new, empty Show file for you with your
chosen name, and open its window. If you quit with a Show window open,
it will automatically be reopened the next time you start the program.
You can have multiple Show windows open at the same time, in case you
want to organize your cues into separate groups for controlling
different kinds of integrations (such as perhaps laser cues in one
Show, and video cues in another) and each one will be reopened
automatically and run independently. You can tailor which Shows you
open based on which hardware is being used for a given performance.

image:assets/NewShowWindow.png[Empty Show window,793,418]

=== Show Window Header Elements

At the top of the Show window, above any Tracks that you have added to
it, is a header that allows you to configure the default Enabled
filter (explained <<Shows#enabled-menu,below>>), and to filter which
Tracks are currently visible, which is helpful when you have added a
lot of them to the Show.

If you type any text in the `Filter` box, only tracks that match that
text will be visible. Similarly, if you check the `Loaded Only`
checkbox, only tracks that are currently loaded on a player on the
network will be visible. This is a great way to narrow down your focus
to watch what is going on with tracks the DJ is currently playing.

TIP: The `Loaded Only` checkbox is only visible when Beat Link Trigger
is Online, because otherwise there is no way tracks could be
identified as loaded.

=== Adding Tracks to a Show

Shows don't do anything until they include at least one Track. There
are a number of different ways you can add Tracks to your Show. Most
of them can be found by choosing menu:Tracks[Import Track] in the Show
window menu bar:

image:assets/ImportTrack.png[Import Track menu,793,418]

If you are currently Online, and there are any players on the network
that have rekordbox tracks loaded that are not already part of the
Show, you will see them as options in the menu. Choosing
menu:Tracks[Import Track>from Player 2] (for example) will download
that track from the player, and add everthing needed to work with the
it to the Show file (the elements of a Track row are explained
<<Shows#track-row-elements,below>>, after the other ways of adding
them to a Show).

image:assets/FirstTrackLoaded.png[First track loaded into Show,1009,466]

To help avoid confusion, rather than simply having the player
disappear from the list of import choices if the track it has loaded
is already part of the Show, the menu option is disabled and an
explanation is added:

image:assets/ImportTrackAlready.png[Track already in Show,1009,466]

To make it possible to set up your Show even when you don't have
access to your player network, you can also import Tracks directly
from rekordbod USB or SD media. To do that, mount the media on your
computer, and choose menu:Tracks[Import Track>from Offline Media]. An
Choose Media dialog will appear, from which you can navigate to the
media:

image:assets/ChooseMedia.png[Choose Media dialog,526,369]

Once you click kbd:[Choose Media], the exported database is parsed,
and a Choose Track window is presented, which is very similar to the
<<Players#loading-playing,Loading and Playing Tracks>> interface
offered by the Player Status window (see that section for details
about how to navigate the interface and use the Search feature):

image:assets/ShowChooseTrack.png[Choose Track dialog,720,518]

Once you have found the Track you are looking for, click kbd:[Choose
Track] to add it to the Show.

image:assets/SecondTrackLoaded.png[Second track loaded into Show,1005,589]

TIP: To save time, once you have chosen media to load tracks from
during a Beat Link Trigger session, your media choice is remembered
(and the parsed database export is kept open), so the next time you
choose to import from offline media, the media selection window is
skipped and you are taken right to the track selection window. If you
want to import from different media, click the kbd:[Change Media]
button at the bottom of the window. This also means you will not be
able to eject the media on most operating systems because BLT has it
open; if you do need to eject it without quitting BLT, choose
menu:Tracks[Import Track>from Offline Media], click kbd:[Change
Media], and it will be closed so you can eject it. At that point you
can click kbd:[Cancel] if you did not actually want to import a Track.

The final way to add a Track to a Show is to copy it from another
Show. When you have multiple Show windows open, you can copy Tracks
from one to another by finding the Track in the open Show that already
contains it, then choosing menu:Copy to Show “<name>”[] in the Track's
context menu:

image:assets/CopyTrack.png[Copy Track to Show,1005,625]

TIP: If you don't see an open Show in the `Copy to` list, that means
the Track is already present in the other Show.

[[track-row-elements]]
== Track Row Elements

Tracks are kept sorted alpahabetically by title and artist in the Show
window (and remember that you can narrow the display to include only
those matching a string you type in the `Filter` field). If there is
album art available, it is shown at the top left. To the right of that
is a column that shows the track title, artist, a comment field, and
information about which players have the track loaded, and which are
currently playing it.

image:assets/ShowTrack.png[A Track row,900,165]

=== Comment Field

The comment field starts out holding whatever comment the DJ entered
about the track in rekordbox, but you are free to edit it however you
like, to help you remember things about the track or to make it easy
to find using the `Filter` field.

=== Waveform Preview

The waveform preview section shows the overall intensity and dominant
frequencies of the track from beginning to end. As in the Player
Status window, you can see the locations of hot cues and memory points
in the waveform preview, and if any players have the track loaded, you
can see their playback position markers. (Unlike in the Player Status
window, you may see more than one player position on a single track,
because the same track might be loaded in more than one player.) The
tick marks along the bottom each represent one minute of playback time.

Along the bottom of the track row you find the controls that let you
configure how you want the Show to respond to the track.

=== Context Menu Button

This allows you to access the track Context Menu with a regular mouse
click. The contents of the menu itself are described
<<Shows#context-menu,below>>.

=== MIDI Output Menu

The menu:MIDI Output[] Menu lets you choose the MIDI device to which
the trigger will send messages when you configure it to send MIDI
messages for particular events. It will show all MIDI outputs
currently available on your system.

The chosen MIDI output will be used for all messages that the Track
is configured to send, including those belonging to any Cues created
in the Track. But each Track can have its own MIDI output, in case
you have a large show with many cues.

NOTE: As with the MIDI Output Menu in the
<<Triggers#midi-output-menu,Triggers window>>, if a MIDI Output is
chosen which is no longer available on the system, it will remain in
that Track's menu, but the Enabled section of the Track will be
replaced with the message “Not found.” Once the output reappears, or a
different output is chosen, the Track will become operational again.

=== Loaded Status

To the right of the MIDI Output menu there is a Loaded Status
indicator which shows whether the Track is currently enabled (a
green circle) or disabled (a red circle with a slash). If any player
currently has the Track loaded, there is a filled circle inside the
enabled ring:

[width="50%",cols=".^,^.^",options="header"]
|===
|State
|Indicator

|Disabled, Not Loaded
|image:assets/Disabled.png[Disabled,52,52]

|Enabled, Not Loaded
|image:assets/Enabled.png[Enabled,52,52]

|Disabled, Loaded
|image:assets/DisabledPlaying.png[alt=Disabled, Playing,width=52,height=52]

|Enabled, Loaded
|image:assets/EnabledPlaying.png[alt=Enabled, Playing,width=52,height=52]

|===

=== Loaded Message Menu

The menu:Loaded Message[] Menu determines what kind of MIDI message is
sent when the Track first becomes loaded by any player (as long as the
Track is Enabled, as described below), or when the track is unloaded
by the last player that had loaded it.

image:assets/LoadedMessageMenu.png[Loaded Message Menu,1005,625]

None:: With this setting, which is the default, nothing is sent when
the Track loads or unloads. Note that this is different from low-level
Triggers, which always send something--you need to remember to pick
the kind of message to be sent for any Show events that you want to
respond to.
+
When None is chosen, there are no interface elements visible to
configure the event. They will appear once you choose an event type to
send.

Note:: With this setting, the Show sends a Note On message, with
velocity 127 and the note number shown to the right of the menu, when
the Track gets loaded onto the first player (as long as the Track is
enabled), and a Note Off message when the last player unloads the
Track, or the Track is disabled.
+
image:assets/LoadedNote.png[A Track row,1079,157]
+
The Channel on which the Loaded/Unloaded messages are sent is
configured just to the right of the note selector.

CC:: With this setting, the Show sends a Control Change message,
with value 127 and the controller number shown to the right of the
menu, when the the Track is loaded (as long as it is enabled), and
sends a CC with value 0 when the Track is unloaded or becomes
disabled.

Custom:: When this option is chosen, you can send any kind of message
you want when the Track loads and/or unloads, by writing code as
described in the <<Expressions#track-loaded-expression,Expressions>>
section. This gives you the most flexibility because in addition to
MIDI messages, you can send arbitrary UDP packets, HTTP requests, or
whatever you might need.

==== Loaded Note/Controller Spinner

Found immediately to the right of the menu:Loaded Message[] Menu (unless
None is chosen as the Message type), this field lets you set the MIDI
note number used for Note-based  loaded and unloaded messages, or the
controller number used for Control Change-based loaded and unloaded
messages. The value is also available to your Track expressions if they
want to use it.

==== Loaded Channel Spinner

As described above, this lets you specify the MIDI channel on which
loaded/unloaded messages are sent for this Track.

=== Playing Status

To the right of the Loaded Message section there is a Playing Status
indicator. As with the Loaded Status indicator, it has an outer
circle which shows whether the Track is currently enabled (a
green circle) or disabled (a red circle with a slash). If any player
is currently playing the Track, there is a filled circle inside the
enabled ring:

[width="50%",cols=".^,^.^",options="header"]
|===
|State
|Indicator

|Disabled, Not Playing
|image:assets/Disabled.png[Disabled,52,52]

|Enabled, Not Playing
|image:assets/Enabled.png[Enabled,52,52]

|Disabled, Playing
|image:assets/DisabledPlaying.png[alt=Disabled, Playing,width=52,height=52]

|Enabled, Playing
|image:assets/EnabledPlaying.png[alt=Enabled, Playing,width=52,height=52]

|===

=== Playing Message Menu

The menu:Playing Message[] Menu determines what kind of MIDI message is
sent when the first player starts playing the Track (as long as the
Track is Enabled, as described below), or when the last player that
was playing the track stops.

image:assets/PlayingMessageMenu.png[Playing Message Menu,1261,230]

None:: With this setting, which is the default, nothing is sent when
the Track starts or stops playing. Note that this is different from
low-level Triggers, which always send something--you need to remember
to pick the kind of message to be sent for any Show events that you
want to respond to.
+
When None is chosen, there are no interface elements visible to
configure the event. They will appear once you choose an event type to
send, as shown in the screen shot above.

Note:: With this setting, the Show sends a Note On message, with
velocity 127 and the note number shown to the right of the menu, when
some player starts playing the Track (as long as the Track is
enabled), and a Note Off message when the last player playing it
stops, or the Track is disabled.
+
The Channel on which the Started/Stopped messages are sent is
configured just to the right of the note selector.

CC:: With this setting, the Show sends a Control Change message,
with value 127 and the controller number shown to the right of the
menu, when the the Track starts playing (as long as it is enabled), and
sends a CC with value 0 when the Track is stopped or becomes
disabled.

Custom:: When this option is chosen, you can send any kind of message
you want when the Track starts and/or stops, by writing code as
described in the <<Expressions#track-playing-expression,Expressions>>
section. This gives you the most flexibility because in addition to
MIDI messages, you can send arbitrary UDP packets, HTTP requests, or
whatever you might need.

==== Playing Note/Controller Spinner

Found immediately to the right of the menu:Playing Message[] Menu (unless
None is chosen as the Message type), this field lets you set the MIDI
note number used for Note-based  started and stopped messages, or the
controller number used for Control Change-based started and stopped
messages. The value is also available to your Track expressions if they
want to use it.

==== Playing Channel Spinner

As described above, this lets you specify the MIDI channel on which
started/stopped messages are sent for this Track.

[[enabled-menu]]
=== Enabled Menu

The menu:Enabled[] menu controls whether the Show will react to
players doing things with the Track.

image:assets/TrackEnabledMenu.png[Enabled Menu,1005,582]

Default:: With this setting, which will be used by most Tracks, the
Show's shared menu:Enabled Default[] menu (at the top of the window)
is used. This allows you to enable and disable most or all tracks
using a common set of rules, while special tracks that need to be
different can still use their own settings. All of the options in this
list (except for Default itself) are available in the Enabled Default
menu, and have the same meaning there, being used by any Tracks whose
own Enabled menu is set to Default.

Never:: With this setting, the Track is disabled until you re-enable
it.

On-Air:: With this setting, the Track is enabled whenever it is
loaded by at least one player that reports that it is On the Air. (For
that to work, the player must be connected to a Nexus mixer, and must
have the feature turned on.)

Master:: With this setting, the Track is enabled whenever it is loaded
by the player that is the current Tempo Master.

Custom:: With this setting, the Track is controlled by an Enabled
Filter, Clojure code that you write yourself. Whenever a status update
is received from any player, your expressions are evaluated. If the
last expression in your filter returns a `true` value, the Track will
be enabled. This lets you apply sophisticated logic, like enabling the
Track when another track is loaded into a different player, or only
during particular times of day. Expressions are further explained in
the <<Expressions#track-enabled-filter-expression,Expressions>>
section. If you choose `Custom` and have not yet written an Enabled
Filter expression, the expression editor will be opened to let you do
that.

Always:: With this setting, the Track is enabled until you disable
it.

[[context-menu]]
=== Context Menu

_This section needs to be finished, and a lot of new screen shots
taken!_

== Adding Track Cues

== Learning More

****

* Continue to <<Link#working-with-ableton-link,Working with Ableton Link>>
* Return to <<{guide-top}#beat-link-trigger-user-guide,Top>>

****

// Once Git finally supports it, change this to: include::Footer.adoc[]
== License

+++<a href="http://deepsymmetry.org"><img src="assets/DS-logo-bw-200-padded-left.png" align="right" alt="Deep Symmetry logo" width="216" height="123"></a>+++
Copyright © 2016&ndash;2019 http://deepsymmetry.org[Deep Symmetry, LLC]

Distributed under the
http://opensource.org/licenses/eclipse-1.0.php[Eclipse Public License
1.0], the same as Clojure. By using this software in any fashion, you
are agreeing to be bound by the terms of this license. You must not
remove this notice, or any other, from this software. A copy of the
license can be found in
https://github.com/Deep-Symmetry/beat-link-trigger/blob/master/LICENSE[LICENSE]
within this project.

=== Library Licenses

https://sourceforge.net/projects/remotetea/[Remote Tea],
used for communicating with the NFSv2 servers on players,
is licensed under the
https://opensource.org/licenses/LGPL-2.0[GNU Library General
Public License, version 2].

The http://kaitai.io[Kaitai Struct] Java runtime, used for parsing
rekordbox exports and media analysis files, is licensed under the
https://opensource.org/licenses/MIT[MIT License].
